<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
		<script src="required/jquery.js"></script>
		<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
		<script src="required/turf.min.js"></script>
		<style>
			#map{
				height: 100%;
				width: 100%;
			}
		</style>
		<title>Turf js and turf tin tests</title>
	</head>
	<body>
		<div id="map" class="map"></div>
		<script type="text/javascript">
			var map = L.map('map').setView([35, -5], 4);
			L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
				attribution: 'Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
				maxZoom: 17,
				minZoom: 1
			}).addTo(map);
			
			var ptsLayer = new L.geoJson();
			ptsLayer.addTo(map);
			var points=[];

			// load GeoJSON from an external file
			/*$.getJSON("data/points.geojson",function(data){
				// add GeoJSON layer to the map once the file is loaded
				ptsLayer = L.geoJson(data,{
					onEachFeature: function( feature, layer ){
						points.push(turf.point(feature.geometry.coordinates, {z: '5'}));
						console.log(JSON.stringify(turf.point(feature.geometry.coordinates)));
					}
				}).addTo(map);
			});*/

			var tinLayer=L.geoJson().addTo(map);

			calculateTIN();

			function calculateTIN() {
				// generate some random point data
				var vertices = turf.random('points', 30, {
					bbox: [-10, 20, 10, 40]
				});
				//var vertices=turf.featureCollection(points);
				//console.log(JSON.stringify(vertices));
				//=points
				// add a random property to each point between 0 and 9
				for (var i = 0; i < vertices.features.length; i++) {
					vertices.features[i].properties.z = ~~(Math.random() * 9);
				}

				var min=vertices.features[0];
				for(var i = 1; i < vertices.features.length; i++){
					min=(min.properties.z<vertices.features[i].properties.z)?min:vertices.features[i];
				}
				//console.log("lowest point "+JSON.stringify(min));

				var max=vertices.features[0];
				for(var i = 1; i < vertices.features.length; i++){
					max=(max.properties.z>vertices.features[i].properties.z)?max:vertices.features[i];
				}
				//console.log("highest point "+JSON.stringify(max));

				var tin = turf.tin(vertices, 'z');
				
				var z=min.properties.z;
				var verticesContourLines={};
				while(z<=max.properties.z){
					var sameLevelPoints=[];
					for( var i =0; i < vertices.features.length; i++){
						if(z==vertices.features[i].properties.z){
							sameLevelPoints.push(vertices.features[i]);
						}
					}
					verticesContourLines[z]=sameLevelPoints;
					//console.log(JSON.stringify(sameLevelPoints));
					z+=2;
				}

				//=tin
				tinLayer.addData(tin);
				//console.log(JSON.stringify(verticesContourLines));
				console.log(JSON.stringify(tin));
			}
		</script>
	</body>
</html>